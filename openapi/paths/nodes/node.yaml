get:
  operationId: describeNode
  tags: [nodes]
  summary: Get details of a single node in the node pool (self-managed or cloud)
  description: |
    **Retrieve the details of a single node in the node pool**
    
    Fetch comprehensive metadata for a specific node in your pool. The response includes a `node_type` 
    property to distinguish between self-managed (SSH) nodes and cloud-imported instances. The response 
    structure varies based on the node type, with cloud nodes including pricing and instance information, 
    while self-managed nodes include SSH connection details and heartbeat information.
  parameters:
    - name: node_id
      in: path
      required: true
      schema:
        type: string
        format: uuid
      description: ID of the node to describe
  responses:
    '200':
      $ref: '../../components/responses/node-response.yaml'
      useExample: cloud-node
    '404':
      $ref: '../../components/responses/error-response.yaml'
      useExample: node-not-found
    '500':
      $ref: '../../components/responses/error-response.yaml'
      useExample: server-error
  x-codeSamples:
    - lang: curl
      label: cURL
      source: |
        curl -X GET "https://api.exalsius.ai/node/123e4567-e89b-12d3-a456-426614174000"
    - lang: python
      label: Python
      source: |
        import requests
        from typing import Optional

        def get_node(node_id: str) -> dict:
            """
            Get details of a single node in the node pool.

            Args:
                node_id: The ID of the node to describe
                
            Returns:
                dict: The JSON response containing the node details
            """
            url = f"https://api.exalsius.ai/node/{node_id}"
            response = requests.get(url)
            return response.json()

        node = get_node("123e4567-e89b-12d3-a456-426614174000")
        print(node)

delete:
  operationId: deleteNode
  tags: [nodes]
  summary: Delete a node from the pool
  description: |
    **Delete a node from the pool**
    
    Permanently delete a node from your node pool. This operation is only allowed when the node is in the 
    `AVAILABLE` state.
    
    **Warning: This operation is irreversible.**
    
    **Prerequisites:**
    - The node must be in the `AVAILABLE` state
    - If the node is currently in use (i.e., not available), you must first detach it from its cluster
    
    **Behavior:**
    - The node will be permanently removed from your node pool
    - Once deleted, the node cannot be used in any cluster deployments
    - For cloud nodes, this does not terminate the instance; it only removes it from the pool
    - For self-managed nodes, the node is simply removed from management

  parameters:
    - name: node_id
      in: path
      required: true
      schema:
        type: string
        format: uuid
      description: ID of the node to delete
  responses:
    '200':
      $ref: '../../components/responses/node-delete-response.yaml'
      useExample: success
    '404':
      $ref: '../../components/responses/error-response.yaml'
      useExample: node-not-found
    '409':
      $ref: '../../components/responses/error-response.yaml'
      useExample: node-not-in-available-state
    '500':
      $ref: '../../components/responses/error-response.yaml'
      useExample: server-error

  x-codeSamples:
    - lang: curl
      label: cURL
      source: |
        curl -X DELETE "https://api.exalsius.ai/node/123e4567-e89b-12d3-a456-426614174000"
    - lang: python
      label: Python
      source: |
        import requests

        def delete_node(node_id: str) -> dict:
            """
            Delete a node from the pool.

            Args:
                node_id: The ID of the node to delete
                
            Returns:
                dict: The JSON response
            """
            url = f"https://api.exalsius.ai/node/{node_id}"
            response = requests.delete(url)
            return response.json()

        result = delete_node("123e4567-e89b-12d3-a456-426614174000")
        print(result)

patch:
  operationId: patchNode
  tags: [nodes]
  summary: Patch a node
  security:
    - OAuth2:
      # This operation is accessible by users (openid) and m2m applications with scope nodeagent
      - openid
      - nodeagent
  description: |
    **Patch a node**
    
    Update a node's properties or send a heartbeat signal. This endpoint is typically used by node agents 
    to report status updates and maintain connectivity.
    
    **Behavior:**
    - If request body is provided, the node's properties (description, hardware specs) will be updated
    - If no request body is provided, this acts as a heartbeat to indicate the node is still active
    - For self-managed nodes, this updates the `last_heartbeat_date`
    - Returns an access token that can be used for subsequent operations

  parameters:
    - name: node_id
      in: path
      required: true
      schema:
        type: string
        format: uuid
  
  requestBody:
    required: false
    content:
      application/json:
        schema:
          $ref: '../../components/requests/node-patch-request.yaml'
  responses:
    '200':
      $ref: '../../components/responses/node-patch-response.yaml'
      useExample: success
    '404':
      $ref: '../../components/responses/error-response.yaml'
      useExample: node-not-found
    '500':
      $ref: '../../components/responses/error-response.yaml'
      useExample: server-error